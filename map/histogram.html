<html><head>  
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
    
    .gridlines .domain {
      display: none;
    }
    
    .gridlines line {
      stroke: rgb(121, 121, 121);
    }
      
  
    </style>
  
  </head>
  <body>
    <div class="container larger">
  
    <svg id="barchart" height="500" width="500" style="margin-top:50px" >
    </svg>
    <div id="button-bar"></div>
  

    <script id="histogram">
  
    const svg = d3.select("svg#barchart");
    const width = svg.attr("width");
    const height = svg.attr("height");
    const margin = {top: 10, right: 10, bottom: 50, left: 60};
    const chartWidth = width - margin.left - margin.right;
    const chartHeight = height - margin.top - margin.bottom;
  
    let annotations = svg.append("g").attr("id","annotations");
    let chartArea = svg.append("g").attr("id","points")
                    .attr("transform",`translate(${margin.left},${margin.top})`);
  
    d3.csv("train.csv", d3.autoType)
      .then( (data) => {
    
        
    data = data.filter(d => (d['Age'] != null));
    console.log(data);
    const ageExtent = d3.extent(data , d => d['Age']);
    const ageScale = d3.scaleLinear().domain([0, ageExtent[1]]).range([0, chartWidth]);
    let total = []
    let max = 0; 
    for (i = 10; i<=  ageExtent[1]; i+=10){
      total[i] = 0;
    }
    data.forEach( d => {
      let age = d['Age'];      
      Object.keys(total).forEach (key => {
        if (age <= key && age >key-10){
          let curr = total[key] + 1;
          if (curr > max)
            max = curr;
          total[key] = curr;
        }
      });
    });
    console.log(total);
    max = Math.ceil(max / 10) * 10 + 10
    const totalScale = d3.scaleLinear().domain([0, max]).range([chartHeight, 0]);

    let leftAxis = d3.axisLeft(totalScale);
    let leftGridlines = d3.axisLeft(totalScale)
                          .tickSize(-chartWidth-10)
                          .tickFormat('')
    annotations.append("g")
               .attr("class", "y axis")
               .attr("transform",`translate(${margin.left-10},${margin.top})`)
               .call(leftAxis)
    annotations.append("g")
               .attr("class", "y gridlines")
               .attr("transform",`translate(${margin.left},${margin.top})`)
               .call(leftGridlines);
    
    let bottomAxis = d3.axisBottom(ageScale)
                      .tickFormat(d3.format(''));
    let bottomGridlines = d3
                    .axisBottom(ageScale)
                    .tickSize(-chartHeight)
                    .tickFormat('');
    annotations.append("g")
               .attr("class", "x axis")
               .attr('transform',`translate(${margin.left},${chartHeight + margin.top + 10})`)               
               .call(bottomAxis);
    annotations.append("g")
               .attr("class", "x gridlines")
               .attr('transform',`translate(${margin.left},${chartHeight + margin.top})`)               
               .call(bottomGridlines);

    annotations.append("text")
    .attr("class", "x label")
    .attr("text-anchor", "middle")
    .attr("x", ageScale(ageExtent[1]/2) + margin.left ) 
    .attr("y", chartHeight + margin.bottom+ 5)
    .text("Age Groups");

    annotations.append("text")
    .attr("class", "y label")
    .attr("text-anchor", "middle")
    .attr("x", -height/2+ margin.right) 
    .attr("y", ageScale(3))
    .attr("transform", "rotate(-90)")
    .text("Population Totals");

      Object.keys(total).forEach (key => {
        chartArea.append("rect")
        .attr("x",ageScale( key-10 ))
        .attr("y",totalScale(total[key]) )
        .attr("height", chartHeight -totalScale(total[key]))
        .attr("width",ageScale( 10 ) )
        .style("stroke", "gray" )
        .style("fill", "pink" );
        // .style("stroke", colorScale( d.percentSurvived ) )

        chartArea.append("text")
        .attr("text-anchor","middle")
        .attr("font-size","15px")
        .attr("x",ageScale(key -5))
        .attr('y',totalScale(total[key]) - 5)
        .text(total[key]);
      });
    
    });  
    
    </script>
  
  
    </div>
  </body>
  </html>
  